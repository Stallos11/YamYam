import{D as le,v as T,u as U,d as z,r as I,y as D,o as n,c as m,F as k,x as N,s as C,b as a,w as r,e as g,a as e,t as l,f as s,j as x,B as M,E as ce,I as ie,m as de}from"./index-1f826056.js";import{a as re,u as ue}from"./recipeCategories-0eb14854.js";const G=le("recipe-comment",{state:()=>({isLoading:!1,comments:[]}),actions:{async getComments(){var _;const f=T();return this.isLoading=!0,this.axios.get(`recipe-comments/${(_=f.selectedRecipe)==null?void 0:_.id}`).then(t=>{t.data&&(this.comments=t.data)}).catch(t=>console.error(t)).finally(()=>this.isLoading=!1)},async addComment(f,_){var p,w,R;this.isLoading=!0;const t=T(),v=U();return this.axios.post(`recipe-comments/${(p=t.selectedRecipe)==null?void 0:p.id}`,{message:f,stars:_,user_id:(w=v.user)==null?void 0:w.id,recipe_id:(R=t.selectedRecipe)==null?void 0:R.id}).then(async()=>{await this.getComments()}).catch(c=>console.error(c)).finally(()=>this.isLoading=!1)},async deleteComment(f){return this.isLoading=!0,this.axios.delete(`recipe-comments/${f}`).then(async()=>{await this.getComments()}).catch(_=>console.error(_)).finally(()=>this.isLoading=!1)}}}),me={class:"mb-5"},_e={class:"grix xs2"},pe={class:"mt-2"},fe=z({__name:"AddComment",setup(f){const _=G(),t=I({stars:1,message:""}),v=D(()=>!(t.value.message.length>1&&t.value.message.length<=140)),p=async()=>{v.value||(await _.addComment(t.value.message,t.value.stars),t.value={stars:1,message:""})};return(w,R)=>{const c=x("Icon"),b=x("ax-form-control"),V=x("ax-form-field"),B=x("ax-form"),L=x("ax-btn");return n(),m("div",me,[(n(),m(k,null,N(5,h=>(n(),m(k,null,[h>t.value.stars?(n(),C(c,{key:0,onClick:P=>t.value.stars=h,class:"mr-2 text-yellow",icon:"material-symbols:star-outline",width:"25"},null,8,["onClick"])):(n(),C(c,{key:1,class:"mr-2 text-yellow",onClick:P=>t.value.stars=h,icon:"material-symbols:star",width:"25"},null,8,["onClick"]))],64))),64)),a(B,{class:"mt-3"},{default:r(()=>[a(V,{label:"Message"},{default:r(()=>[a(b,{modelValue:t.value.message,"onUpdate:modelValue":R[0]||(R[0]=h=>t.value.message=h),tag:"textarea"},{default:r(()=>[g("Message")]),_:1},8,["modelValue"])]),_:1})]),_:1}),e("div",_e,[e("p",pe,l(t.value.message.length)+" / 140",1),a(L,{disabled:s(v),onClick:p,class:"rounded-3 px-4 py-1 amaranth d-block ml-auto mr-3 font-s2 mt-2"},{default:r(()=>[g("Send")]),_:1},8,["disabled"])])])}}}),he={class:"rounded-2 shadow-2 bd-1 bd-solid bd-grey bd-dark-4 mb-3 py-2 px-3"},xe={class:"d-flex vcenter"},ge={class:"my-0"},ve={class:"mb-0",style:{"word-break":"break-word"}},be=e("p",{class:"text-center"},"Êtes-vous sûr ? ?",-1),ye={class:"grix xs2 center"},oe=z({__name:"RecipeComment",props:["comment"],setup(f){const _=f,t=G(),v=U(),p=I(!1),w=async()=>{await t.deleteComment(_.comment.id),p.value=!1};return(R,c)=>{var L;const b=x("Icon"),V=x("ax-btn"),B=x("ax-modal");return n(),m(k,null,[e("div",he,[e("div",xe,[e("p",ge,l(f.comment.user.firstname),1),f.comment.user_id===((L=s(v).user)==null?void 0:L.id)?(n(),C(b,{key:0,icon:"mdi:trash",width:"20",class:"text-red ml-auto",onClick:c[0]||(c[0]=h=>p.value=!0)})):M("",!0)]),(n(),m(k,null,N(5,h=>(n(),m(k,null,[h>f.comment.stars?(n(),C(b,{key:0,class:"mr-2 text-yellow",icon:"material-symbols:star-outline",width:"20"})):(n(),C(b,{key:1,class:"mr-2 text-yellow",icon:"material-symbols:star",width:"20"}))],64))),64)),e("p",ve,l(f.comment.message),1)]),a(B,{class:"bg-dark rounded-1 shadow-1",modelValue:p.value,"onUpdate:modelValue":c[2]||(c[2]=h=>p.value=h)},{header:r(()=>[be]),default:r(()=>[e("div",ye,[a(V,{onClick:c[1]||(c[1]=h=>p.value=!1),class:"grey px-4 py-1 rounded-3"},{default:r(()=>[g("Annuler")]),_:1}),a(V,{onClick:w,class:"red px-4 py-1 rounded-3"},{default:r(()=>[g("Supprimer")]),_:1})])]),_:1},8,["modelValue"])],64)}}}),ke={key:0,class:"h100 d-flex vcenter fx-center"},we={key:1,class:"p-5"},Ce={key:0,class:"grix xs2 center"},Re={class:"font-s4"},$e={class:"font-s3 text-grey text-light-2"},Se={class:"grix xs2 my-3"},Ve={class:"grix xs4 center my-3"},Le={class:"d-flex vcenter"},De={class:"d-flex vcenter"},Ie={class:"d-flex vcenter"},Ne={class:"d-flex vcenter"},Be={class:"d-flex vcenter mt-5"},Ae=e("div",{class:"d-flex vcenter"},[e("div",{class:"fx-grow bd-2 bd-grey bd-dark-3 bd-b-solid"}),e("h2",{class:"font-w400 text-center m-3 font-s5"},"Ingrédients"),e("div",{class:"fx-grow bd-2 bd-grey bd-dark-3 bd-b-solid"})],-1),Ee={class:"d-flex fx-row mb-5"},Me=["href"],Pe=["src"],Fe={class:"pl-3"},Te={class:"my-0 font-s2"},Ue={class:"text-grey"},ze=e("div",{class:"d-flex vcenter"},[e("div",{class:"fx-grow bd-2 bd-grey bd-dark-3 bd-b-solid"}),e("h2",{class:"font-w400 text-center m-3 font-s5"},"Instructions"),e("div",{class:"fx-grow bd-2 bd-grey bd-dark-3 bd-b-solid"})],-1),Ge={class:"mb-5"},Oe={class:"my-0 font-s2"},je={class:"my-0 font-s2"},qe=e("div",{class:"d-flex vcenter"},[e("div",{class:"fx-grow bd-2 bd-grey bd-dark-3 bd-b-solid"}),e("h2",{class:"font-w400 text-center m-3 font-s5"},"Nutriments"),e("div",{class:"fx-grow bd-2 bd-grey bd-dark-3 bd-b-solid"})],-1),He={class:"d-flex fx-col px-3"},Je={class:"nutri"},Ke=e("span",null,"Energie",-1),Qe={class:"nutri"},We=e("span",null,"Gras",-1),Xe={class:"nutri"},Ye=e("span",null,"Acides gras saturés",-1),Ze={class:"nutri"},et=e("span",null,"Glucides",-1),tt={class:"nutri"},st=e("span",null,"Sucres",-1),ot={class:"nutri"},nt=e("span",null,"Protéines",-1),at={class:"nutri"},lt=e("span",null,"Sel",-1),ct=e("div",{class:"d-flex vcenter mt-5"},[e("div",{class:"fx-grow bd-2 bd-grey bd-dark-3 bd-b-solid"}),e("h2",{class:"font-w400 text-center m-3 font-s5"},"Commentaires"),e("div",{class:"fx-grow bd-2 bd-grey bd-dark-3 bd-b-solid"})],-1),it=e("p",{class:"text-center"},"Etes-vous sûr ?",-1),dt={class:"grix xs2 center"},mt=z({__name:"Details",setup(f){const _=U(),t=T(),v=re(),p=ue(),w=G(),R=de(),c=I(),b=I(!1);ce(async()=>{var u,o;v.recipe_categories.length||await v.fetchData(),p.recipe_types.length||await p.fetchData(),(u=t.selectedRecipe)!=null&&u.id||await t.showDetails(R.params.id),await w.getComments(),c.value=(o=t.selectedRecipe)==null?void 0:o.eaters_amount});const V=I(["kcal","carbohydrates","fat","saturated_fat","proteins","salt","sugars"]),B=I({mg:1e-5,g:.01,kg:10,mL:1e-5,cL:.001,L:10}),L=D(()=>w.comments.filter(u=>{var o;return u.user_id===((o=_.user)==null?void 0:o.id)})),h=D(()=>w.comments.filter(u=>{var o;return u.user_id!=((o=_.user)==null?void 0:o.id)})),P=()=>{c.value--,c.value<1&&(c.value=1)},ne=()=>{c.value++},S=D(()=>{let u={};return V.value.forEach(o=>{var d;u[o]=(d=t.selectedRecipe)==null?void 0:d.ingredients.reduce(($,A)=>{var E;const F=A[o]*A.amount*B.value[A.unit]*c.value/((E=t.selectedRecipe)==null?void 0:E.eaters_amount);return $+F},0).toFixed(3)}),u}),O=D(()=>{var u;return((u=v.recipe_categories.find(o=>{var d;return o.id==((d=t.selectedRecipe)==null?void 0:d.recipe_category_id)}))==null?void 0:u.category)||!1}),j=D(()=>{var u;return((u=p.recipe_types.find(o=>{var d;return o.id==((d=t.selectedRecipe)==null?void 0:d.recipe_type_id)}))==null?void 0:u.type)||!1}),ae=()=>{b.value=!0};return(u,o)=>{var q,H,J,K,Q,W,X,Y,Z,ee,te,se;const d=x("Icon"),$=x("ax-btn"),A=x("ax-form-control"),F=x("ax-form-field"),E=x("ax-modal");return n(),m(k,null,[s(t).isLoading?(n(),m("div",ke,[a(d,{icon:"eos-icons:bubble-loading",width:"40",class:"text-white"})])):(n(),m("div",we,[((q=s(t).selectedRecipe)==null?void 0:q.user_id)==((H=s(_).user)==null?void 0:H.id)?(n(),m("div",Ce,[a($,{onClick:o[0]||(o[0]=i=>{var y;return s(t).editRecipe((y=s(t).selectedRecipe)==null?void 0:y.id)}),class:"btn-circle primary d-flex vcenter fx-center"},{default:r(()=>[a(d,{icon:"mdi:pen",width:"30"})]),_:1}),a($,{onClick:o[1]||(o[1]=i=>ae()),class:"btn-circle amaranth d-flex vcenter fx-center"},{default:r(()=>[a(d,{icon:"mdi:trash",width:"30"})]),_:1})])):M("",!0),e("p",Re,l((J=s(t).selectedRecipe)==null?void 0:J.name),1),e("p",$e,l((K=s(t).selectedRecipe)==null?void 0:K.description),1),e("div",Se,[s(O)?(n(),C($,{key:0,class:"primary rounded-2 font-s2 px-4 py-1"},{default:r(()=>[g(l(s(O)),1)]),_:1})):M("",!0),s(j)?(n(),C($,{key:1,class:"secondary rounded-2 font-s2 px-4 py-1"},{default:r(()=>[g(l(s(j)),1)]),_:1})):M("",!0)]),e("div",{class:"rounded-2",style:ie([{"min-height":"12rem","background-size":"cover","background-position":"center"},`background-image: url('data:image/png;base64, ${(Q=s(t).selectedRecipe)==null?void 0:Q.image}')`])},null,4),e("div",Ve,[e("div",Le,[a(d,{icon:"ic:baseline-access-time",width:"20",class:"mr-2"}),g(" "+l((W=s(t).selectedRecipe)==null?void 0:W.preparation_time),1)]),e("div",De,[a(d,{icon:"icon-park-outline:cook",width:"20",class:"mr-2"}),g(" "+l((X=s(t).selectedRecipe)==null?void 0:X.cooking_time),1)]),e("div",Ie,[a(d,{icon:"mdi:flame",width:"20",class:"mr-2"}),g(" "+l((Y=s(t).selectedRecipe)==null?void 0:Y.difficulty),1)]),e("div",Ne,[a(d,{icon:"mdi:cards-heart-outline",width:"20",class:"mr-2"}),g(" "+l(((ee=(Z=s(t).selectedRecipe)==null?void 0:Z.favourites)==null?void 0:ee.length)||0),1)])]),e("div",Be,[a(d,{onClick:P,icon:"line-md:minus-circle",width:"25"}),a(F,{class:"my-0 mx-3",label:"Nbr Personnes"},{default:r(()=>[a(A,{tag:"input",modelValue:c.value,"onUpdate:modelValue":o[2]||(o[2]=i=>c.value=i),type:"number",min:"0"},null,8,["modelValue"])]),_:1}),a(d,{onClick:ne,icon:"line-md:plus-circle",width:"25"})]),Ae,(n(!0),m(k,null,N((te=s(t).selectedRecipe)==null?void 0:te.ingredients,i=>{var y;return n(),m("div",Ee,[e("a",{target:"_blank",href:`https://fr.openfoodfacts.org/produit/${i.openfoodfact_id}`},[e("img",{class:"rounded-2 ingredient-img",src:i.img},null,8,Pe)],8,Me),e("div",Fe,[e("p",Te,l(i.product_name),1),e("span",Ue,"x"+l((i.amount*c.value/((y=s(t).selectedRecipe)==null?void 0:y.eaters_amount)).toFixed(0))+" "+l(i.unit),1)])])}),256)),ze,(n(!0),m(k,null,N((se=s(t).selectedRecipe)==null?void 0:se.instructions,(i,y)=>(n(),m("div",Ge,[e("p",Oe,l(`${y+1}. ${i.title}`),1),e("p",je,l(i.description),1)]))),256)),qe,e("div",He,[e("div",Je,[Ke,e("span",null,l(s(S).kcal)+" kCal",1)]),e("div",Qe,[We,e("span",null,l(s(S).fat)+" g",1)]),e("div",Xe,[Ye,e("span",null,l(s(S).saturated_fat)+" g",1)]),e("div",Ze,[et,e("span",null,l(s(S).carbohydrates)+" g",1)]),e("div",tt,[st,e("span",null,l(s(S).sugars)+" g",1)]),e("div",ot,[nt,e("span",null,l(s(S).proteins)+" g",1)]),e("div",at,[lt,e("span",null,l(s(S).salt)+" g",1)])]),ct,a(fe),(n(!0),m(k,null,N(s(L),i=>(n(),C(oe,{comment:i},null,8,["comment"]))),256)),(n(!0),m(k,null,N(s(h),i=>(n(),C(oe,{comment:i},null,8,["comment"]))),256))])),a(E,{class:"bg-dark rounded-1 shadow-1",modelValue:b.value,"onUpdate:modelValue":o[5]||(o[5]=i=>b.value=i)},{header:r(()=>[it]),default:r(()=>[e("div",dt,[a($,{onClick:o[3]||(o[3]=i=>b.value=!1),class:"grey px-4 py-1 rounded-3"},{default:r(()=>[g("Annuler")]),_:1}),a($,{onClick:o[4]||(o[4]=i=>{var y;return s(t).deleteRecipe((y=s(t).selectedRecipe)==null?void 0:y.id)}),class:"red px-4 py-1 rounded-3"},{default:r(()=>[g("Supprimer")]),_:1})])]),_:1},8,["modelValue"])],64)}}});export{mt as default};
