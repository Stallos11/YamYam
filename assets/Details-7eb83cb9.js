import{D as le,v as P,u as T,d as U,r as I,y as L,o as n,c as m,F as k,x as B,s as C,b as a,w as r,e as x,a as e,t as l,f as s,j as g,B as M,I as ce,H as ie,k as de}from"./index-1544c40c.js";import{a as re,u as ue}from"./recipeCategories-210b033d.js";const z=le("recipe-comment",{state:()=>({isLoading:!1,comments:[]}),actions:{async getComments(){var _;const f=P();return this.isLoading=!0,this.axios.get(`recipe-comments/${(_=f.selectedRecipe)==null?void 0:_.id}`).then(t=>{t.data&&(this.comments=t.data)}).catch(t=>console.error(t)).finally(()=>this.isLoading=!1)},async addComment(f,_){var p,w,R;this.isLoading=!0;const t=P(),v=T();return this.axios.post(`recipe-comments/${(p=t.selectedRecipe)==null?void 0:p.id}`,{message:f,stars:_,user_id:(w=v.user)==null?void 0:w.id,recipe_id:(R=t.selectedRecipe)==null?void 0:R.id}).then(async()=>{await this.getComments()}).catch(c=>console.error(c)).finally(()=>this.isLoading=!1)},async deleteComment(f){return this.isLoading=!0,this.axios.delete(`recipe-comments/${f}`).then(async()=>{await this.getComments()}).catch(_=>console.error(_)).finally(()=>this.isLoading=!1)}}}),me={class:"mb-5"},_e={class:"grix xs2"},pe={class:"mt-2"},fe=U({__name:"AddComment",setup(f){const _=z(),t=I({stars:1,message:""}),v=L(()=>!(t.value.message.length>1&&t.value.message.length<=140)),p=async()=>{v.value||(await _.addComment(t.value.message,t.value.stars),t.value={stars:1,message:""})};return(w,R)=>{const c=g("Icon"),y=g("ax-form-control"),V=g("ax-form-field"),N=g("ax-form"),D=g("ax-btn");return n(),m("div",me,[(n(),m(k,null,B(5,h=>(n(),m(k,null,[h>t.value.stars?(n(),C(c,{key:0,onClick:A=>t.value.stars=h,class:"mr-2 text-yellow",icon:"material-symbols:star-outline",width:"25"},null,8,["onClick"])):(n(),C(c,{key:1,class:"mr-2 text-yellow",onClick:A=>t.value.stars=h,icon:"material-symbols:star",width:"25"},null,8,["onClick"]))],64))),64)),a(N,{class:"mt-3"},{default:r(()=>[a(V,{label:"Message"},{default:r(()=>[a(y,{modelValue:t.value.message,"onUpdate:modelValue":R[0]||(R[0]=h=>t.value.message=h),tag:"textarea"},{default:r(()=>[x("Message")]),_:1},8,["modelValue"])]),_:1})]),_:1}),e("div",_e,[e("p",pe,l(t.value.message.length)+" / 140",1),a(D,{disabled:s(v),onClick:p,class:"rounded-3 px-4 py-1 amaranth d-block ml-auto mr-3 font-s2 mt-2"},{default:r(()=>[x("Send")]),_:1},8,["disabled"])])])}}}),he={class:"rounded-2 shadow-2 bd-1 bd-solid bd-grey bd-dark-4 mb-3 py-2 px-3"},ge={class:"d-flex vcenter"},xe={class:"my-0"},ve={class:"mb-0",style:{"word-break":"break-all"}},ye=e("p",{class:"text-center"},"Are you sure ?",-1),be={class:"grix xs2 center"},se=U({__name:"RecipeComment",props:["comment"],setup(f){const _=f,t=z(),v=T(),p=I(!1),w=async()=>{await t.deleteComment(_.comment.id),p.value=!1};return(R,c)=>{var D;const y=g("Icon"),V=g("ax-btn"),N=g("ax-modal");return n(),m(k,null,[e("div",he,[e("div",ge,[e("p",xe,l(f.comment.user.firstname),1),f.comment.user_id===((D=s(v).user)==null?void 0:D.id)?(n(),C(y,{key:0,icon:"mdi:trash",width:"20",class:"text-red ml-auto",onClick:c[0]||(c[0]=h=>p.value=!0)})):M("",!0)]),(n(),m(k,null,B(5,h=>(n(),m(k,null,[h>f.comment.stars?(n(),C(y,{key:0,class:"mr-2 text-yellow",icon:"material-symbols:star-outline",width:"20"})):(n(),C(y,{key:1,class:"mr-2 text-yellow",icon:"material-symbols:star",width:"20"}))],64))),64)),e("p",ve,l(f.comment.message),1)]),a(N,{class:"bg-dark rounded-1 shadow-1",modelValue:p.value,"onUpdate:modelValue":c[2]||(c[2]=h=>p.value=h)},{header:r(()=>[ye]),default:r(()=>[e("div",be,[a(V,{onClick:c[1]||(c[1]=h=>p.value=!1),class:"grey px-4 py-1 rounded-3"},{default:r(()=>[x("Cancel")]),_:1}),a(V,{onClick:w,class:"red px-4 py-1 rounded-3"},{default:r(()=>[x("Delete")]),_:1})])]),_:1},8,["modelValue"])],64)}}}),ke={key:0,class:"h100 d-flex vcenter fx-center"},we={key:1,class:"p-5"},Ce={key:0,class:"grix xs2 center"},Re={class:"font-s4"},$e={class:"font-s3 text-grey text-light-2"},Se={class:"grix xs2 my-3"},Ve={class:"grix xs4 center my-3"},De={class:"d-flex vcenter"},Le={class:"d-flex vcenter"},Ie={class:"d-flex vcenter"},Be={class:"d-flex vcenter"},Ne={class:"d-flex vcenter mt-5"},Fe=e("div",{class:"d-flex vcenter"},[e("div",{class:"fx-grow bd-2 bd-grey bd-dark-3 bd-b-solid"}),e("h2",{class:"font-w400 text-center m-3 font-s5"},"Ingredients"),e("div",{class:"fx-grow bd-2 bd-grey bd-dark-3 bd-b-solid"})],-1),Me={class:"d-flex fx-row mb-5"},Ae=["href"],Ee=["src"],Pe={class:"pl-3"},Te={class:"my-0 font-s2"},Ue={class:"text-grey"},ze=e("div",{class:"d-flex vcenter"},[e("div",{class:"fx-grow bd-2 bd-grey bd-dark-3 bd-b-solid"}),e("h2",{class:"font-w400 text-center m-3 font-s5"},"Instructions"),e("div",{class:"fx-grow bd-2 bd-grey bd-dark-3 bd-b-solid"})],-1),Oe={class:"mb-5"},je={class:"my-0 font-s2"},He={class:"my-0 font-s2"},qe=e("div",{class:"d-flex vcenter"},[e("div",{class:"fx-grow bd-2 bd-grey bd-dark-3 bd-b-solid"}),e("h2",{class:"font-w400 text-center m-3 font-s5"},"Nutriments"),e("div",{class:"fx-grow bd-2 bd-grey bd-dark-3 bd-b-solid"})],-1),Ge={class:"d-flex fx-col px-3"},Je={class:"nutri"},Ke=e("span",null,"Energy",-1),Qe={class:"nutri"},We=e("span",null,"Fat",-1),Xe={class:"nutri"},Ye=e("span",null,"Saturated Fat",-1),Ze={class:"nutri"},et=e("span",null,"Carbs",-1),tt={class:"nutri"},st=e("span",null,"Sugars",-1),ot={class:"nutri"},nt=e("span",null,"Proteins",-1),at={class:"nutri"},lt=e("span",null,"Salt",-1),ct=e("div",{class:"d-flex vcenter mt-5"},[e("div",{class:"fx-grow bd-2 bd-grey bd-dark-3 bd-b-solid"}),e("h2",{class:"font-w400 text-center m-3 font-s5"},"Comments"),e("div",{class:"fx-grow bd-2 bd-grey bd-dark-3 bd-b-solid"})],-1),it=e("p",{class:"text-center"},"Are you sure ?",-1),dt={class:"grix xs2 center"},mt=U({__name:"Details",setup(f){const _=T(),t=P(),v=re(),p=ue(),w=z(),R=de(),c=I(),y=I(!1);ce(async()=>{var u,o;v.recipe_categories.length||await v.fetchData(),p.recipe_types.length||await p.fetchData(),(u=t.selectedRecipe)!=null&&u.id||await t.showDetails(R.params.id),await w.getComments(),c.value=(o=t.selectedRecipe)==null?void 0:o.eaters_amount});const V=I(["kcal","carbohydrates","fat","saturated_fat","proteins","salt","sugars"]),N=I({mg:1e-5,g:.01,kg:10,mL:1e-5,cL:.001,L:10}),D=L(()=>w.comments.filter(u=>{var o;return u.user_id===((o=_.user)==null?void 0:o.id)})),h=L(()=>w.comments.filter(u=>{var o;return u.user_id!=((o=_.user)==null?void 0:o.id)})),A=()=>{c.value--,c.value<1&&(c.value=1)},oe=()=>{c.value++},S=L(()=>{let u={};return V.value.forEach(o=>{var d;u[o]=(d=t.selectedRecipe)==null?void 0:d.ingredients.reduce(($,F)=>{const E=F[o]*F.amount*N.value[F.unit]*c.value;return $+E},0).toFixed(3)}),u}),O=L(()=>{var u;return((u=v.recipe_categories.find(o=>{var d;return o.id==((d=t.selectedRecipe)==null?void 0:d.recipe_category_id)}))==null?void 0:u.category)||!1}),j=L(()=>{var u;return((u=p.recipe_types.find(o=>{var d;return o.id==((d=t.selectedRecipe)==null?void 0:d.recipe_type_id)}))==null?void 0:u.type)||!1}),ne=()=>{y.value=!0};return(u,o)=>{var H,q,G,J,K,Q,W,X,Y,Z,ee,te;const d=g("Icon"),$=g("ax-btn"),F=g("ax-form-control"),E=g("ax-form-field"),ae=g("ax-modal");return n(),m(k,null,[s(t).isLoading?(n(),m("div",ke,[a(d,{icon:"eos-icons:bubble-loading",width:"40",class:"text-white"})])):(n(),m("div",we,[((H=s(t).selectedRecipe)==null?void 0:H.user_id)==((q=s(_).user)==null?void 0:q.id)?(n(),m("div",Ce,[a($,{onClick:o[0]||(o[0]=i=>{var b;return s(t).editRecipe((b=s(t).selectedRecipe)==null?void 0:b.id)}),class:"btn-circle primary d-flex vcenter fx-center"},{default:r(()=>[a(d,{icon:"mdi:pen",width:"30"})]),_:1}),a($,{onClick:o[1]||(o[1]=i=>ne()),class:"btn-circle amaranth d-flex vcenter fx-center"},{default:r(()=>[a(d,{icon:"mdi:trash",width:"30"})]),_:1})])):M("",!0),e("p",Re,l((G=s(t).selectedRecipe)==null?void 0:G.name),1),e("p",$e,l((J=s(t).selectedRecipe)==null?void 0:J.description),1),e("div",Se,[s(O)?(n(),C($,{key:0,class:"primary rounded-2 font-s2 px-4 py-1"},{default:r(()=>[x(l(s(O)),1)]),_:1})):M("",!0),s(j)?(n(),C($,{key:1,class:"secondary rounded-2 font-s2 px-4 py-1"},{default:r(()=>[x(l(s(j)),1)]),_:1})):M("",!0)]),e("div",{class:"rounded-2",style:ie([{"min-height":"12rem","background-size":"cover","background-position":"center"},`background-image: url('data:image/png;base64, ${(K=s(t).selectedRecipe)==null?void 0:K.image}')`])},null,4),e("div",Ve,[e("div",De,[a(d,{icon:"ic:baseline-access-time",width:"20",class:"mr-2"}),x(" "+l((Q=s(t).selectedRecipe)==null?void 0:Q.preparation_time),1)]),e("div",Le,[a(d,{icon:"icon-park-outline:cook",width:"20",class:"mr-2"}),x(" "+l((W=s(t).selectedRecipe)==null?void 0:W.cooking_time),1)]),e("div",Ie,[a(d,{icon:"mdi:flame",width:"20",class:"mr-2"}),x(" "+l((X=s(t).selectedRecipe)==null?void 0:X.difficulty),1)]),e("div",Be,[a(d,{icon:"mdi:cards-heart-outline",width:"20",class:"mr-2"}),x(" "+l(((Z=(Y=s(t).selectedRecipe)==null?void 0:Y.favourites)==null?void 0:Z.length)||0),1)])]),e("div",Ne,[a(d,{onClick:A,icon:"line-md:minus-circle",width:"25"}),a(E,{class:"my-0 mx-3",label:"Eaters amount"},{default:r(()=>[a(F,{tag:"input",modelValue:c.value,"onUpdate:modelValue":o[2]||(o[2]=i=>c.value=i),type:"number",min:"0"},null,8,["modelValue"])]),_:1}),a(d,{onClick:oe,icon:"line-md:plus-circle",width:"25"})]),Fe,(n(!0),m(k,null,B((ee=s(t).selectedRecipe)==null?void 0:ee.ingredients,i=>{var b;return n(),m("div",Me,[e("a",{target:"_blank",href:`https://fr.openfoodfacts.org/produit/${i.openfoodfact_id}`},[e("img",{class:"rounded-2 ingredient-img",src:i.img},null,8,Ee)],8,Ae),e("div",Pe,[e("p",Te,l(i.product_name),1),e("span",Ue,"x"+l(i.amount*c.value/((b=s(t).selectedRecipe)==null?void 0:b.eaters_amount))+" "+l(i.unit),1)])])}),256)),ze,(n(!0),m(k,null,B((te=s(t).selectedRecipe)==null?void 0:te.instructions,(i,b)=>(n(),m("div",Oe,[e("p",je,l(`${b+1}. ${i.title}`),1),e("p",He,l(i.description),1)]))),256)),qe,e("div",Ge,[e("div",Je,[Ke,e("span",null,l(s(S).kcal)+" kCal",1)]),e("div",Qe,[We,e("span",null,l(s(S).fat)+" g",1)]),e("div",Xe,[Ye,e("span",null,l(s(S).saturated_fat)+" g",1)]),e("div",Ze,[et,e("span",null,l(s(S).carbohydrates)+" g",1)]),e("div",tt,[st,e("span",null,l(s(S).sugars)+" g",1)]),e("div",ot,[nt,e("span",null,l(s(S).proteins)+" g",1)]),e("div",at,[lt,e("span",null,l(s(S).salt)+" g",1)])]),ct,a(fe),(n(!0),m(k,null,B(s(D),i=>(n(),C(se,{comment:i},null,8,["comment"]))),256)),(n(!0),m(k,null,B(s(h),i=>(n(),C(se,{comment:i},null,8,["comment"]))),256))])),a(ae,{class:"bg-dark rounded-1 shadow-1",modelValue:y.value,"onUpdate:modelValue":o[5]||(o[5]=i=>y.value=i)},{header:r(()=>[it]),default:r(()=>[e("div",dt,[a($,{onClick:o[3]||(o[3]=i=>y.value=!1),class:"grey px-4 py-1 rounded-3"},{default:r(()=>[x("Cancel")]),_:1}),a($,{onClick:o[4]||(o[4]=i=>{var b;return s(t).deleteRecipe((b=s(t).selectedRecipe)==null?void 0:b.id)}),class:"red px-4 py-1 rounded-3"},{default:r(()=>[x("Delete")]),_:1})])]),_:1},8,["modelValue"])],64)}}});export{mt as default};
